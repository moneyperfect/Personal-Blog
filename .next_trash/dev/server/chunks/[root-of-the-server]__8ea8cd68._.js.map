{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/personal-site/src/lib/admin-auth.ts"],"sourcesContent":["import { cookies } from 'next/headers';\nimport { redirect } from 'next/navigation';\n\n/**\n * 验证管理员是否已登录\n */\nexport async function verifyAdminAuth(): Promise<boolean> {\n  try {\n    const cookieStore = await cookies();\n    const token = cookieStore.get('admin_token')?.value;\n\n    if (!token) {\n      return false;\n    }\n\n    // 简单的令牌验证（在生产环境中应使用更安全的方法）\n    const decoded = Buffer.from(token, 'base64').toString('utf-8');\n    const [username, timestamp] = decoded.split(':');\n    \n    if (username !== 'admin') {\n      return false;\n    }\n\n    // 检查令牌是否过期（24小时）\n    const tokenTime = parseInt(timestamp, 10);\n    const now = Date.now();\n    const maxAge = 24 * 60 * 60 * 1000; // 24小时\n\n    if (now - tokenTime > maxAge) {\n      return false;\n    }\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * 保护路由，如果未登录则重定向到登录页\n */\nexport async function protectAdminRoute() {\n  const isAuthenticated = await verifyAdminAuth();\n  \n  if (!isAuthenticated) {\n    redirect('/admin');\n  }\n}\n\n/**\n * 获取认证状态，用于客户端组件\n */\nexport function getAdminAuthStatus(): boolean {\n  // 注意：这是一个客户端函数，不能使用 cookies()\n  // 实际实现应该在客户端检查 localStorage 或 cookie\n  // 这里返回 false，实际状态由组件自己管理\n  return false;\n}"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAAA;;;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,gBAAgB;QAE9C,IAAI,CAAC,OAAO;YACV,OAAO;QACT;QAEA,2BAA2B;QAC3B,MAAM,UAAU,OAAO,IAAI,CAAC,OAAO,UAAU,QAAQ,CAAC;QACtD,MAAM,CAAC,UAAU,UAAU,GAAG,QAAQ,KAAK,CAAC;QAE5C,IAAI,aAAa,SAAS;YACxB,OAAO;QACT;QAEA,iBAAiB;QACjB,MAAM,YAAY,SAAS,WAAW;QACtC,MAAM,MAAM,KAAK,GAAG;QACpB,MAAM,SAAS,KAAK,KAAK,KAAK,MAAM,OAAO;QAE3C,IAAI,MAAM,YAAY,QAAQ;YAC5B,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAKO,eAAe;IACpB,MAAM,kBAAkB,MAAM;IAE9B,IAAI,CAAC,iBAAiB;QACpB,IAAA,mMAAQ,EAAC;IACX;AACF;AAKO,SAAS;IACd,8BAA8B;IAC9B,qCAAqC;IACrC,yBAAyB;IACzB,OAAO;AACT"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///E:/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/personal-site/src/lib/notes-utils.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport matter from 'gray-matter';\n\nexport interface NoteMetadata {\n  id: string;\n  title: string;\n  slug: string;\n  category: string;\n  type: string;\n  language: string;\n  date: string;\n  enabled: boolean;\n  source: 'obsidian' | 'notion' | 'local';\n  tags?: string[];\n  summary?: string;\n  updatedAt?: string;\n}\n\n// 笔记元数据存储文件路径\nconst NOTES_METADATA_PATH = path.join(process.cwd(), 'content', 'notes-metadata.json');\n\n/**\n * 获取所有笔记的元数据\n */\nexport async function getAllNotesMetadata(): Promise<NoteMetadata[]> {\n  try {\n    // 读取笔记元数据文件（如果存在）\n    let metadataMap: Record<string, Partial<NoteMetadata>> = {};\n    if (fs.existsSync(NOTES_METADATA_PATH)) {\n      const metadataContent = fs.readFileSync(NOTES_METADATA_PATH, 'utf8');\n      metadataMap = JSON.parse(metadataContent);\n    }\n\n    const notesDir = path.join(process.cwd(), 'content', 'notes');\n    const files = fs.readdirSync(notesDir).filter(file => file.endsWith('.mdx'));\n\n    const notes: NoteMetadata[] = [];\n\n    for (const file of files) {\n      try {\n        const filePath = path.join(notesDir, file);\n        const fileContent = fs.readFileSync(filePath, 'utf8');\n        const { data: frontmatter } = matter(fileContent);\n\n        // 从文件名提取slug和语言\n        const match = file.match(/^(.+)\\.(zh|ja)\\.mdx$/);\n        const slug = match ? match[1] : file.replace('.mdx', '');\n        const language = (match ? match[2] : 'zh') as 'zh' | 'ja';\n\n        // 获取该笔记的元数据（如果存在）\n        const noteMetadata = metadataMap[slug] || {};\n        \n        notes.push({\n          id: slug,\n          title: (frontmatter.title as string) || slug,\n          slug,\n          category: (frontmatter.category as string) || '',\n          type: (frontmatter.type as string) || 'note',\n          language,\n          date: (frontmatter.updatedAt as string) || new Date().toISOString().split('T')[0],\n          enabled: noteMetadata.enabled !== undefined ? noteMetadata.enabled : true, // 默认启用\n          source: 'obsidian',\n          tags: frontmatter.tags as string[] || [],\n          summary: frontmatter.summary as string || '',\n          updatedAt: frontmatter.updatedAt as string,\n        });\n      } catch (error) {\n        console.error(`解析笔记文件 ${file} 失败:`, error);\n      }\n    }\n\n    // 按日期倒序排序\n    return notes.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n  } catch (error) {\n    console.error('获取笔记元数据失败:', error);\n    return [];\n  }\n}\n\n/**\n * 更新笔记元数据\n */\nexport async function updateNoteMetadata(\n  slug: string,\n  updates: Partial<NoteMetadata>\n): Promise<boolean> {\n  try {\n    // 读取现有的元数据\n    let metadataMap: Record<string, Partial<NoteMetadata>> = {};\n    if (fs.existsSync(NOTES_METADATA_PATH)) {\n      const metadataContent = fs.readFileSync(NOTES_METADATA_PATH, 'utf8');\n      metadataMap = JSON.parse(metadataContent);\n    }\n\n    // 更新指定笔记的元数据\n    metadataMap[slug] = {\n      ...metadataMap[slug],\n      ...updates,\n    };\n\n    // 写回文件\n    fs.writeFileSync(NOTES_METADATA_PATH, JSON.stringify(metadataMap, null, 2), 'utf8');\n    return true;\n  } catch (error) {\n    console.error('更新笔记元数据失败:', error);\n    return false;\n  }\n}\n\n/**\n * 批量更新笔记元数据\n */\nexport async function batchUpdateNotesMetadata(\n  updates: Record<string, Partial<NoteMetadata>>\n): Promise<boolean> {\n  try {\n    // 读取现有的元数据\n    let metadataMap: Record<string, Partial<NoteMetadata>> = {};\n    if (fs.existsSync(NOTES_METADATA_PATH)) {\n      const metadataContent = fs.readFileSync(NOTES_METADATA_PATH, 'utf8');\n      metadataMap = JSON.parse(metadataContent);\n    }\n\n    // 批量更新\n    for (const [slug, update] of Object.entries(updates)) {\n      metadataMap[slug] = {\n        ...metadataMap[slug],\n        ...update,\n      };\n    }\n\n    // 写回文件\n    fs.writeFileSync(NOTES_METADATA_PATH, JSON.stringify(metadataMap, null, 2), 'utf8');\n    return true;\n  } catch (error) {\n    console.error('批量更新笔记元数据失败:', error);\n    return false;\n  }\n}\n\n/**\n * 获取统计数据\n */\nexport async function getNotesStats(): Promise<{\n  totalNotes: number;\n  publishedNotes: number;\n  draftNotes: number;\n  totalViews: number;\n  viewsGrowth: number;\n  topCategory: string;\n}> {\n  const notes = await getAllNotesMetadata();\n  \n  // 计算类别分布\n  const categoryCount: Record<string, number> = {};\n  notes.forEach(note => {\n    const category = note.category || '未分类';\n    categoryCount[category] = (categoryCount[category] || 0) + 1;\n  });\n\n  // 找出最常见的类别\n  let topCategory = '未分类';\n  let maxCount = 0;\n  for (const [category, count] of Object.entries(categoryCount)) {\n    if (count > maxCount) {\n      maxCount = count;\n      topCategory = category;\n    }\n  }\n\n  const publishedNotes = notes.filter(note => note.enabled).length;\n  const draftNotes = notes.filter(note => !note.enabled).length;\n\n  // 模拟视图数据（实际应该从Google Analytics获取）\n  const totalViews = notes.length * 100; // 简单模拟\n  const viewsGrowth = 12.5; // 模拟增长率\n\n  return {\n    totalNotes: notes.length,\n    publishedNotes,\n    draftNotes,\n    totalViews,\n    viewsGrowth,\n    topCategory: topCategory === '' ? '未分类' : topCategory,\n  };\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///E:/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/personal-site/src/app/api/admin/notes/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { verifyAdminAuth } from '@/lib/admin-auth';\nimport { getAllNotesMetadata, updateNoteMetadata, batchUpdateNotesMetadata } from '@/lib/notes-utils';\n\n/**\n * GET: 获取所有笔记\n */\nexport async function GET(request: NextRequest) {\n  try {\n    // 验证管理员权限\n    const isAuthenticated = await verifyAdminAuth();\n    if (!isAuthenticated) {\n      return NextResponse.json(\n        { error: '未授权访问' },\n        { status: 401 }\n      );\n    }\n\n    const notes = await getAllNotesMetadata();\n    return NextResponse.json({ notes });\n  } catch (error) {\n    console.error('获取笔记列表失败:', error);\n    return NextResponse.json(\n      { error: '服务器错误' },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST: 更新笔记状态\n */\nexport async function POST(request: NextRequest) {\n  try {\n    // 验证管理员权限\n    const isAuthenticated = await verifyAdminAuth();\n    if (!isAuthenticated) {\n      return NextResponse.json(\n        { error: '未授权访问' },\n        { status: 401 }\n      );\n    }\n\n    const body = await request.json();\n    const { action, slug, updates, batchUpdates } = body;\n\n    if (batchUpdates) {\n      // 批量更新\n      const success = await batchUpdateNotesMetadata(batchUpdates);\n      return NextResponse.json({ success });\n    }\n\n    if (!slug) {\n      return NextResponse.json(\n        { error: '缺少笔记slug参数' },\n        { status: 400 }\n      );\n    }\n\n    let success = false;\n\n    switch (action) {\n      case 'toggle-enabled':\n        // 获取当前笔记状态\n        const notes = await getAllNotesMetadata();\n        const note = notes.find(n => n.slug === slug);\n        if (note) {\n          success = await updateNoteMetadata(slug, { enabled: !note.enabled });\n        }\n        break;\n\n      case 'update-category':\n        if (!updates?.category) {\n          return NextResponse.json(\n            { error: '缺少分类参数' },\n            { status: 400 }\n          );\n        }\n        success = await updateNoteMetadata(slug, { category: updates.category });\n        break;\n\n      case 'update':\n        if (!updates) {\n          return NextResponse.json(\n            { error: '缺少更新参数' },\n            { status: 400 }\n          );\n        }\n        success = await updateNoteMetadata(slug, updates);\n        break;\n\n      default:\n        return NextResponse.json(\n          { error: '不支持的操作' },\n          { status: 400 }\n        );\n    }\n\n    return NextResponse.json({ success });\n  } catch (error) {\n    console.error('更新笔记失败:', error);\n    return NextResponse.json(\n      { error: '服务器错误' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAKO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,UAAU;QACV,MAAM,kBAAkB,MAAM,IAAA,gJAAe;QAC7C,IAAI,CAAC,iBAAiB;YACpB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAQ,GACjB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,MAAM,IAAA,qJAAmB;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAM;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,aAAa;QAC3B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAQ,GACjB;YAAE,QAAQ;QAAI;IAElB;AACF;AAKO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,UAAU;QACV,MAAM,kBAAkB,MAAM,IAAA,gJAAe;QAC7C,IAAI,CAAC,iBAAiB;YACpB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAQ,GACjB;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,YAAY,EAAE,GAAG;QAEhD,IAAI,cAAc;YAChB,OAAO;YACP,MAAM,UAAU,MAAM,IAAA,0JAAwB,EAAC;YAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE;YAAQ;QACrC;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAa,GACtB;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,UAAU;QAEd,OAAQ;YACN,KAAK;gBACH,WAAW;gBACX,MAAM,QAAQ,MAAM,IAAA,qJAAmB;gBACvC,MAAM,OAAO,MAAM,IAAI,CAAC,CAAA,IAAK,EAAE,IAAI,KAAK;gBACxC,IAAI,MAAM;oBACR,UAAU,MAAM,IAAA,oJAAkB,EAAC,MAAM;wBAAE,SAAS,CAAC,KAAK,OAAO;oBAAC;gBACpE;gBACA;YAEF,KAAK;gBACH,IAAI,CAAC,SAAS,UAAU;oBACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;wBAAE,OAAO;oBAAS,GAClB;wBAAE,QAAQ;oBAAI;gBAElB;gBACA,UAAU,MAAM,IAAA,oJAAkB,EAAC,MAAM;oBAAE,UAAU,QAAQ,QAAQ;gBAAC;gBACtE;YAEF,KAAK;gBACH,IAAI,CAAC,SAAS;oBACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;wBAAE,OAAO;oBAAS,GAClB;wBAAE,QAAQ;oBAAI;gBAElB;gBACA,UAAU,MAAM,IAAA,oJAAkB,EAAC,MAAM;gBACzC;YAEF;gBACE,OAAO,gJAAY,CAAC,IAAI,CACtB;oBAAE,OAAO;gBAAS,GAClB;oBAAE,QAAQ;gBAAI;QAEpB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAQ;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,WAAW;QACzB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAQ,GACjB;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}