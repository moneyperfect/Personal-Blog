# 部署检查清单

## 部署前必做事项

### ✅ 1. 环境变量配置
- [ ] **ADMIN_PASSWORD**：设置强密码（12位以上，混合字符）
- [ ] **NEXT_PUBLIC_SITE_URL**：生产环境完整URL（如 `https://yourdomain.com`）
- [ ] **OBSIDIAN_NOTES_PATH**：设置为 `./obsidian-notes`

### ✅ 2. 密码安全
- [ ] 不使用默认密码 `admin123`
- [ ] 生产环境使用强密码
- [ ] 定期更换密码
- [ ] 不同环境使用不同密码

### ✅ 3. 子模块验证
- [ ] `.gitmodules` 文件配置正确
- [ ] Obsidian子模块URL可公开访问
- [ ] `vercel.json` 包含子模块初始化命令
- [ ] 首次部署后检查子模块是否成功拉取

### ✅ 4. 文件权限
- [ ] `content/notes-metadata.json` 有写入权限
- [ ] `content/notes/` 目录有读取权限
- [ ] 生产环境文件系统权限正确

## Vercel部署步骤

### 第一步：项目导入
1. [ ] 访问 [vercel.com](https://vercel.com)
2. [ ] 点击 "New Project"
3. [ ] 导入GitHub仓库 `moneyperfect/Personal-Blog`
4. [ ] 确认项目名称和设置

### 第二步：环境变量配置
1. [ ] 进入项目设置 → Environment Variables
2. [ ] 添加以下变量：
   - `ADMIN_PASSWORD` = `你的强密码`
   - `NEXT_PUBLIC_SITE_URL` = `你的生产域名`
   - `OBSIDIAN_NOTES_PATH` = `./obsidian-notes`
3. [ ] 保存环境变量

### 第三步：部署配置
1. [ ] 确认 `vercel.json` 配置正确
2. [ ] 检查Build Command为默认值
3. [ ] 确认Output Directory为 `.next`
4. [ ] 启用自动部署（推送到main分支）

### 第四步：首次部署
1. [ ] 点击 "Deploy" 开始首次部署
2. [ ] 监控部署日志，确保无错误
3. [ ] 等待部署完成（约2-5分钟）

## 部署后验证

### ✅ 功能测试清单
1. [ ] **网站首页**：访问 `https://yourdomain.com` 正常显示
2. [ ] **管理登录**：访问 `https://yourdomain.com/admin` 显示登录页面
3. [ ] **登录功能**：使用设置的密码成功登录
4. [ ] **仪表板**：登录后显示数据概览
5. [ ] **笔记管理**：点击"笔记管理"标签显示笔记列表
6. [ ] **状态切换**：尝试启用/禁用笔记，确认保存成功
7. [ ] **分类修改**：修改笔记分类，确认保存成功
8. [ ] **图表显示**：确认各种图表正常显示
9. [ ] **退出登录**：点击退出后返回登录页面

### ✅ 数据验证
1. [ ] 检查 `content/notes/` 目录有笔记文件
2. [ ] 确认 `notes-metadata.json` 文件存在且可写入
3. [ ] 验证笔记状态更改后文件正确更新
4. [ ] 检查GitHub Actions同步是否正常工作（如果配置）

### ✅ 安全验证
1. [ ] 确保所有页面通过HTTPS访问
2. [ ] 测试错误密码登录被拒绝
3. [ ] 验证直接访问 `/admin/dashboard` 重定向到登录页
4. [ ] 确认无敏感信息泄露

## 常见问题快速排查

### ❌ 无法访问 `/admin`
- 检查环境变量 `ADMIN_PASSWORD` 是否设置
- 确认Vercel部署完成
- 清除浏览器缓存或使用无痕模式

### ❌ 登录失败
- 确认密码正确（注意大小写）
- 检查环境变量是否生效（可能需要重新部署）
- 查看Vercel部署日志是否有错误

### ❌ 笔记列表为空
- 运行 `npm run convert-obsidian` 转换笔记
- 检查 `content/notes/` 目录是否有 `.mdx` 文件
- 验证子模块是否正确初始化

### ❌ 更改未保存
- 检查 `notes-metadata.json` 文件权限
- 查看浏览器控制台网络请求是否成功
- 确认API端点正常工作

### ❌ 图表不显示
- 检查 `recharts` 依赖是否安装
- 查看浏览器控制台错误信息
- 确认有笔记数据可供图表显示

## 生产环境维护

### 定期检查项目
- **每周**：检查访问日志和安全事件
- **每月**：更新依赖包和密码
- **每季度**：安全审计和备份验证

### 备份策略
1. **自动备份**：GitHub仓库包含所有代码和内容
2. **手动备份**：定期导出 `notes-metadata.json`
3. **环境备份**：Vercel环境变量设置截图保存

### 监控建议
1. **性能监控**：Vercel Analytics查看网站性能
2. **错误监控**：设置错误追踪（如Sentry）
3. **访问监控**：配置基本的访问日志

## 紧急情况处理

### 忘记管理员密码
1. 登录Vercel控制台
2. 修改 `ADMIN_PASSWORD` 环境变量
3. 重新部署应用
4. 使用新密码登录

### 数据丢失恢复
1. 从Git历史恢复 `notes-metadata.json`
2. 从备份文件恢复数据
3. 重新运行笔记转换脚本

### 网站无法访问
1. 检查Vercel部署状态
2. 查看部署日志中的错误信息
3. 回滚到上一个稳定版本
4. 联系Vercel技术支持

## 联系方式和支持

- **文档参考**：查阅 [admin-guide.md](admin-guide.md) 详细指南
- **问题反馈**：GitHub Issues中提交问题
- **紧急支持**：通过项目维护者联系

---

**重要提醒**：首次部署后立即测试所有功能，确保系统正常工作。定期进行安全检查和备份，确保数据安全。